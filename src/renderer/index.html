<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>স্কুল বাস ম্যানেজমেন্ট</title>
    <style>
        @font-face {
            font-family: 'Noto Serif Bengali';
            src: local('Noto Serif Bengali'), 
                 local('NotoSerifBengali'),
                 url('src/renderer/assets/fonts/NotoSerifBengali-Regular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'Noto Serif Bengali';
            src: local('Noto Serif Bengali Bold'), 
                 local('NotoSerifBengali-Bold'),
                 url('fonts/NotoSerifBengali-Bold.ttf') format('truetype');
            font-weight: bold;
            font-style: normal;
        }

        :root {
            --primary: #3b82f6;
            --secondary: #10b981;
            --danger: #ef4444;
            --dark: #1f2937;
            --light: #f3f4f6;
            --boys-color: #3b82f6;
            --girls-color: #ec4899;
            --day-shift-color: #f59e0b;
            --morning-shift-color: #10b981;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Serif Bengali', serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
        }

        .app-title {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--dark);
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* Buttons */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-primary:hover {
            background-color: #0d9f6e;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .btn-revoke {
            background-color: var(--day-shift-color);
            color: white;
        }

        .btn-revoke:hover {
            background-color: #d97706;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .btn-day-shift {
            background-color: var(--day-shift-color);
            color: white;
        }

        /* Shift Tabs */
        .shift-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .shift-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .shift-tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            font-weight: bold;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #ddd;
        }

        .nav-tab {
            padding: 12px 25px;
            cursor: pointer;
            font-weight: bold;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            position: relative;
        }

        .nav-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .nav-tab:hover:not(.active) {
            background-color: #f8f9fa;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form Elements */
        .bus-selection {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .select-box {
            flex: 1;
        }

        .select-box label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .select-box select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background-color: white;
            transition: border 0.3s;
        }

        .select-box select:focus {
            border-color: var(--primary);
            outline: none;
        }

        /* Radio Button */
        .radio-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .radio-option input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
        }

        /* Tables */
        .route-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .route-table th {
            background-color: var(--primary);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }

        .route-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }

        .route-table tr:last-child td {
            border-bottom: none;
        }

        .route-table tr:hover {
            background-color: #f8f9fa;
        }

        .boys-bus {
            color: var(--boys-color);
            font-weight: bold;
        }

        .girls-bus {
            color: var(--girls-color);
            font-weight: bold;
        }

        .action-btn {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1.2rem;
            transition: transform 0.3s;
        }

        .action-btn:hover {
            transform: scale(1.2);
        }

        /* Audio Player */
        .audio-player {
            width: 100%;
            margin-top: 10px;
        }

        /* Status Messages */
        .status-message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .status-success {
            background-color: #d4edda;
            color: #155724;
            display: block;
        }

        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            display: block;
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            vertical-align: middle;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Settings Button Animation */
        .settings-icon {
            transition: transform 0.5s ease-in-out;
            display: inline-block;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .settings-btn:hover .settings-icon {
            animation: spin 2s infinite linear;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .modal-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
            color: var(--dark);
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }

        /* Print Preview Styles */
        .print-preview {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 800px;
            margin: 20px auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .print-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        .print-title {
            font-size: 1.8rem;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .print-subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        /* Display Screen Styles */
        .display-screen {
            background-color: #1f2937;
            color: white;
            padding: 20px;
            border-radius: 8px;
            font-size: 1.5rem;
            text-align: center;
        }

        .display-route {
            font-size: 2rem;
            margin-bottom: 15px;
            color: #fbbf24;
        }

        .display-bus {
            display: inline-block;
            margin: 0 15px;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
        }

        .display-bus-boys {
            background-color: var(--boys-color);
        }

        .display-bus-girls {
            background-color: var(--girls-color);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .bus-selection {
                flex-direction: column;
            }
            
            .nav-tabs {
                flex-direction: column;
                border-bottom: none;
                border-left: 2px solid #ddd;
            }
            
            .nav-tab {
                border-bottom: none;
                border-left: 3px solid transparent;
            }
            
            .nav-tab.active {
                border-left-color: var(--primary);
                border-bottom: none;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .header-controls {
                width: 100%;
                justify-content: space-between;
                flex-wrap: wrap;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 0.9rem;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <!-- Main Container -->
    <div class="container">
        <header class="header">
            <h1 class="app-title">স্কুল বাস ম্যানেজমেন্ট</h1>
            <div class="header-controls">
                <button class="btn btn-revoke" id="print-btn">প্রিন্ট</button>
                <button class="btn btn-danger" id="display-btn">ডিসপ্লে</button>
                <button class="btn btn-primary" id="audio-btn">অডিও</button>
                <div class="settings-btn" id="settings-btn">
                    <span class="settings-icon">⚙️</span>
                </div>
            </div>
        </header>

        <!-- Status Message Area -->
        <div id="status-message" class="status-message"></div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="manual">ম্যানুয়াল নির্ধারণ</div>
            <div class="nav-tab" data-tab="auto">স্বয়ংক্রিয় নির্ধারণ</div>
        </div>

        <!-- Manual Assignment Tab -->
        <div class="tab-content active" id="manual">
            <!-- Shift Radio Buttons -->
            <div class="radio-container">
                <label class="radio-option">
                    <input type="radio" name="shift-type" value="combined" checked>
                    একত্রিত বাস
                </label>
                <label class="radio-option">
                    <input type="radio" name="shift-type" value="separate">
                    পৃথক বাস (ছাত্র/ছাত্রী)
                </label>
            </div>

            <!-- Bus Selection -->
            <div class="bus-selection">
                <div class="select-box">
                    <label for="stand-select">রাস্তা নির্ধারণ করুন</label>
                    <select id="stand-select">
                        <option value="">-- রাস্তা নির্ধারণ করুন --</option>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <div class="select-box" id="bus-select-container">
                    <label for="bus-select">বাস নির্ধারণ করুন</label>
                    <select id="bus-select">
                        <option value="">-- বাস নির্ধারণ করুন --</option>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <div class="select-box" id="boys-bus-select-container" style="display: none;">
                    <label for="boys-bus-select">ছাত্র বাস নির্ধারণ করুন</label>
                    <select id="boys-bus-select">
                        <option value="">-- ছাত্রদের বাস নির্ধারণ করুন --</option>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <div class="select-box" id="girls-bus-select-container" style="display: none;">
                    <label for="girls-bus-select">ছাত্রী বাস নির্ধারণ করুন</label>
                    <select id="girls-bus-select">
                        <option value="">-- ছাত্রী বাস নির্ধারণ করুন --</option>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
            </div>

            <!-- Audio Preview -->
            <div id="audio-preview" style="display: none; margin-bottom: 20px;">
                <h3>অডিও প্রিভিউ</h3>
                <audio controls class="audio-player" id="audio-player">
                    আপনার ব্রাউজার অডিও এলিমেন্ট সাপোর্ট করে না।
                </audio>
            </div>

            <!-- Action Buttons -->
            <div style="text-align: center; margin-bottom: 30px;">
                <button class="btn btn-primary" id="save-btn">সেভ করুন</button>
            </div>

            <!-- Route Table -->
            <table class="route-table" id="assignments-table">
                <thead>
                    <tr id="table-header-combined">
                        <th>স্ট্যান্ডসমূহ</th>
                        <th>বাস নং</th>
                        <th>অডিও</th>
                        <th>এডিট</th>
                    </tr>
                    <tr id="table-header-separate" style="display: none;">
                        <th>স্ট্যান্ডসমূহ</th>
                        <th>ছাত্র বাস</th>
                        <th>ছাত্রী বাস</th>
                        <th>অডিও</th>
                        <th>এডিট</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be populated by JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Auto Assignment Tab -->
        <div class="tab-content" id="auto">
            <!-- Filter Buttons -->
            <div id="filter-buttons" class="flex justify-center mb-8">
                <button data-filter="morning" class="filter-btn bg-blue-700 text-white py-3 px-4 rounded-xl text-lg font-semibold shadow mx-2 hover:bg-blue-800 transition">প্রভাতি শাখা</button>
                <button data-filter="day" class="filter-btn bg-green-700 text-white py-3 px-4 rounded-xl text-lg font-semibold shadow mx-2 hover:bg-green-800 transition">দিবা শাখা</button>
                <button data-filter="all" class="filter-btn bg-gray-800 text-white py-3 px-4 rounded-xl text-lg font-semibold shadow mx-2 hover:bg-black transition">সব শাখা</button>
            </div>

            <!-- Configuration Panel -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10" id="config-panel">
                <div>
                    <label class="block mb-2 text-gray-700 font-semibold">ফিল রেশিও (%)</label>
                    <select id="filRatio" class="w-full border-2 rounded-xl px-4 py-3 focus:ring focus:ring-blue-300">
                        <option value="80">৮০</option>
                        <option value="85">৮৫</option>
                        <option value="90">৯০</option>
                        <option value="95">৯৫</option>
                        <option value="100">১০০</option>
                        <option value="custom">অন্যান্য</option>
                    </select>
                    <div class="mt-2" id="custom-percentage-container" style="display: none;">
                        <input type="number" id="customPercentage" placeholder="আপনার কাস্টম শতাংশ লিখুন" class="w-full border-2 rounded-xl px-4 py-3 focus:ring focus:ring-blue-300" min="1" max="100" />
                    </div>
                </div>
                <div>
                    <label class="block mb-2 text-gray-700 font-semibold">বাস সাজানোর পদ্ধতি</label>
                    <select id="busMethod" class="w-full border-2 rounded-xl px-4 py-3 focus:ring focus:ring-blue-300">
                        <option value="small-first">ছোট বাস আগে</option>
                        <option value="large-first">বড় বাস আগে</option>
                    </select>
                </div>
                <div>
                    <label class="block mb-2 text-gray-700 font-semibold">অগ্রাধিকার ভিত্তিতে</label>
                    <select id="priority" class="w-full border-2 rounded-xl px-4 py-3 focus:ring focus:ring-blue-300">
                        <option value="boys-first">প্রথম ছাত্র</option>
                        <option value="girls-first">প্রথম ছাত্রী</option>
                    </select>
                </div>
            </div>

            <!-- Action Buttons -->
            <div style="text-align: center; margin-bottom: 30px;">
                <button class="btn btn-day-shift" id="run-auto-assign-btn">স্বয়ংক্রিয় নির্ধারণ চালান</button>
            </div>

            <!-- Auto Assignment Results Table -->
            <table class="route-table" id="auto-assignments-table">
                <thead>
                    <tr>
                        <th>ক্রমিক</th>
                        <th>স্ট্যান্ডসমূহ</th>
                        <th>ছাত্র (বাস নং)</th>
                        <th>ছাত্রী (বাস নং)</th>
                        <th>শাখা</th>
                        <th>এডিট</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Print Modal -->
    <div class="modal" id="print-modal">
        <div class="modal-content">
            <h3 class="modal-title">কোন লিস্ট প্রিন্ট করতে চান?</h3>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="print-auto-btn">অটো মোড</button>
                <button class="btn btn-primary" id="print-manual-btn">ম্যানুয়াল মোড</button>
                <button class="btn btn-danger" id="print-cancel-btn">বাতিল</button>
            </div>
        </div>
    </div>

    <!-- Display Modal -->
    <div class="modal" id="display-modal">
        <div class="modal-content">
            <h3 class="modal-title">কোন লিস্ট ডিসপ্লে করতে চান?</h3>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="display-auto-btn">অটো মোড</button>
                <button class="btn btn-primary" id="display-manual-btn">ম্যানুয়াল মোড</button>
                <button class="btn btn-danger" id="display-cancel-btn">বাতিল</button>
            </div>
        </div>
    </div>

    <!-- Print Preview Modal -->
    <div class="modal" id="print-preview-modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="print-preview" id="print-preview-content">
                <div class="print-header">
                    <h2 class="print-title">স্কুল বাস নির্ধারণ লিস্ট</h2>
                    <p class="print-subtitle" id="print-subtitle">প্রভাতি শাখা - ১২ জুন ২০২৫</p>
                </div>
                <table class="route-table">
                    <thead>
                        <tr id="print-table-header">
                            <th>ক্রমিক</th>
                            <th>স্ট্যান্ডসমূহ</th>
                            <th>বাস নং</th>
                        </tr>
                    </thead>
                    <tbody id="print-table-body">
                        <!-- Print data will be populated here -->
                    </tbody>
                </table>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="print-confirm-btn">প্রিন্ট করুন</button>
                <button class="btn btn-danger" id="print-preview-cancel-btn">বাতিল</button>
            </div>
        </div>
    </div>

    <!-- Display Screen Modal -->
    <div class="modal" id="display-screen-modal">
        <div class="modal-content" style="max-width: 900px; background-color: #1f2937;">
            <div class="display-screen" id="display-screen-content">
                <h2 id="display-title">স্কুল বাস নির্ধারণ</h2>
                <div id="display-routes-container">
                    <!-- Display data will be populated here -->
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="display-close-btn">বন্ধ করুন</button>
            </div>
        </div>
    </div>

    <!-- Audio Modal -->
    <div class="modal" id="audio-modal">
        <div class="modal-content">
            <h3 class="modal-title">অডিও জেনারেট করুন</h3>
            <div class="select-box" style="margin-bottom: 20px;">
                <label for="audio-shift-select">শাখা নির্বাচন করুন</label>
                <select id="audio-shift-select" class="w-full">
                    <option value="morning">প্রভাতি শাখা</option>
                    <option value="day">দিবা শাখা</option>
                </select>
            </div>
            <div id="audio-preview-container" style="margin-bottom: 20px; display: none;">
                <h4>অডিও প্রিভিউ</h4>
                <audio controls class="audio-player" id="audio-generator-player"></audio>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="generate-audio-btn">অডিও জেনারেট করুন</button>
                <button class="btn btn-danger" id="audio-cancel-btn">বাতিল</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // DOM Elements
            // Manual mode elements
            const standSelect = document.getElementById('stand-select');
            const busSelect = document.getElementById('bus-select');
            const boysBusSelect = document.getElementById('boys-bus-select');
            const girlsBusSelect = document.getElementById('girls-bus-select');
            const saveBtn = document.getElementById('save-btn');
            const audioPlayer = document.getElementById('audio-player');
            const audioPreview = document.getElementById('audio-preview');
            
            // Radio buttons
            const combinedRadio = document.querySelector('input[name="shift-type"][value="combined"]');
            const separateRadio = document.querySelector('input[name="shift-type"][value="separate"]');
            const busSelectContainer = document.getElementById('bus-select-container');
            const boysBusSelectContainer = document.getElementById('boys-bus-select-container');
            const girlsBusSelectContainer = document.getElementById('girls-bus-select-container');
            const tableHeaderCombined = document.getElementById('table-header-combined');
            const tableHeaderSeparate = document.getElementById('table-header-separate');
            
            // Auto mode elements
            const filterButtons = document.querySelectorAll('.filter-btn');
            const filRatioSelect = document.getElementById('filRatio');
            const customPercentageContainer = document.getElementById('custom-percentage-container');
            const customPercentageInput = document.getElementById('customPercentage');
            const busMethodSelect = document.getElementById('busMethod');
            const prioritySelect = document.getElementById('priority');
            const runAutoAssignBtn = document.getElementById('run-auto-assign-btn');
            
            // Common elements
            const printBtn = document.getElementById('print-btn');
            const displayBtn = document.getElementById('display-btn');
            const audioBtn = document.getElementById('audio-btn');
            const settingsBtn = document.getElementById('settings-btn');
            const statusMessage = document.getElementById('status-message');
            const navTabs = document.querySelectorAll('.nav-tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // Modal elements
            const printModal = document.getElementById('print-modal');
            const printAutoBtn = document.getElementById('print-auto-btn');
            const printManualBtn = document.getElementById('print-manual-btn');
            const printCancelBtn = document.getElementById('print-cancel-btn');
            
            const displayModal = document.getElementById('display-modal');
            const displayAutoBtn = document.getElementById('display-auto-btn');
            const displayManualBtn = document.getElementById('display-manual-btn');
            const displayCancelBtn = document.getElementById('display-cancel-btn');
            
            const printPreviewModal = document.getElementById('print-preview-modal');
            const printPreviewContent = document.getElementById('print-preview-content');
            const printSubtitle = document.getElementById('print-subtitle');
            const printTableHeader = document.getElementById('print-table-header');
            const printTableBody = document.getElementById('print-table-body');
            const printConfirmBtn = document.getElementById('print-confirm-btn');
            const printPreviewCancelBtn = document.getElementById('print-preview-cancel-btn');
            
            const displayScreenModal = document.getElementById('display-screen-modal');
            const displayScreenContent = document.getElementById('display-screen-content');
            const displayTitle = document.getElementById('display-title');
            const displayRoutesContainer = document.getElementById('display-routes-container');
            const displayCloseBtn = document.getElementById('display-close-btn');
            
            const audioModal = document.getElementById('audio-modal');
            const audioShiftSelect = document.getElementById('audio-shift-select');
            const generateAudioBtn = document.getElementById('generate-audio-btn');
            const audioCancelBtn = document.getElementById('audio-cancel-btn');
            const audioGeneratorPlayer = document.getElementById('audio-generator-player');
            const audioPreviewContainer = document.getElementById('audio-preview-container');

            // State variables
            let currentTab = 'manual';
            let currentFilter = 'all';
            let assignments = [];
            let autoAssignments = [];
            let routes = [];
            let buses = [];

            // Initialize the app
            await initApp();

            // Initialize the application
            async function initApp() {
                await loadInitialData();
                setupEventListeners();
            }

            // Load initial data
            async function loadInitialData() {
                try {
                    // Load all necessary data
                    const [morningRoutes, dayRoutes, allBuses, manualAssignments, autoAssignmentsData] = await Promise.all([
                        window.electronAPI.getRoutes('morning'),
                        window.electronAPI.getRoutes('day'),
                        window.electronAPI.getActiveBuses(),
                        window.electronAPI.getManualAssignments(),
                        window.electronAPI.getAutoAssignments()
                    ]);
                    
                    routes = { morning: morningRoutes, day: dayRoutes };
                    buses = allBuses;
                    assignments = manualAssignments;
                    autoAssignments = autoAssignmentsData;
                    
                    populateRouteSelects();
                    populateBusSelects();
                    populateAssignmentsTable();
                    populateAutoAssignmentsTable();
                    
                    // Gray out already assigned options
                    updateDisabledOptions();
                } catch (error) {
                    console.error('Error loading initial data:', error);
                    showStatus('ডেটা লোড করতে সমস্যা হয়েছে', 'error');
                }
            }

            // Set up all event listeners
            function setupEventListeners() {
                // Tab switching functionality
                navTabs.forEach(tab => {
                    tab.addEventListener('click', () => switchTab(tab));
                });

                // Radio button change
                combinedRadio.addEventListener('change', () => toggleBusSelection('combined'));
                separateRadio.addEventListener('change', () => toggleBusSelection('separate'));

                // Save assignment button
                saveBtn.addEventListener('click', saveAssignment);

                // Auto assign button
                runAutoAssignBtn.addEventListener('click', runAutoAssignment);

                // Filter buttons in auto mode
                filterButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        currentFilter = btn.getAttribute('data-filter');
                        filterButtons.forEach(b => b.classList.remove('bg-blue-700', 'bg-green-700', 'bg-gray-800'));
                        btn.classList.add(
                            currentFilter === 'morning' ? 'bg-blue-700' :
                            currentFilter === 'day' ? 'bg-green-700' : 'bg-gray-800'
                        );
                        filterAutoAssignments();
                    });
                });

                // Fill ratio select change
                filRatioSelect.addEventListener('change', () => {
                    if (filRatioSelect.value === 'custom') {
                        customPercentageContainer.style.display = 'block';
                        customPercentageInput.focus();
                    } else {
                        customPercentageContainer.style.display = 'none';
                    }
                });

                // Route select changes for audio loading
                standSelect.addEventListener('change', loadRouteAudio);

                // Header buttons
                printBtn.addEventListener('click', () => printModal.style.display = 'flex');
                displayBtn.addEventListener('click', () => displayModal.style.display = 'flex');
                audioBtn.addEventListener('click', () => audioModal.style.display = 'flex');
                settingsBtn.addEventListener('click', openSettingsWindow);

                // Print modal buttons
                printAutoBtn.addEventListener('click', prepareAutoPrint);
                printManualBtn.addEventListener('click', prepareManualPrint);
                printCancelBtn.addEventListener('click', () => printModal.style.display = 'none');

                // Display modal buttons
                displayAutoBtn.addEventListener('click', showAutoDisplay);
                displayManualBtn.addEventListener('click', showManualDisplay);
                displayCancelBtn.addEventListener('click', () => displayModal.style.display = 'none');

                // Print preview buttons
                printConfirmBtn.addEventListener('click', confirmPrint);
                printPreviewCancelBtn.addEventListener('click', () => printPreviewModal.style.display = 'none');

                // Display screen buttons
                displayCloseBtn.addEventListener('click', () => displayScreenModal.style.display = 'none');

                // Audio modal buttons
                generateAudioBtn.addEventListener('click', generateAudio);
                audioCancelBtn.addEventListener('click', () => audioModal.style.display = 'none');
            }

            // Switch between tabs
            function switchTab(selectedTab) {
                // Remove active class from all tabs and contents
                navTabs.forEach(tab => tab.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                // Add active class to selected tab and corresponding content
                selectedTab.classList.add('active');
                currentTab = selectedTab.getAttribute('data-tab');
                document.getElementById(currentTab).classList.add('active');
            }

            // Toggle between combined and separate bus selection
            function toggleBusSelection(type) {
                if (type === 'combined') {
                    busSelectContainer.style.display = 'block';
                    boysBusSelectContainer.style.display = 'none';
                    girlsBusSelectContainer.style.display = 'none';
                    tableHeaderCombined.style.display = '';
                    tableHeaderSeparate.style.display = 'none';
                } else {
                    busSelectContainer.style.display = 'none';
                    boysBusSelectContainer.style.display = 'block';
                    girlsBusSelectContainer.style.display = 'block';
                    tableHeaderCombined.style.display = 'none';
                    tableHeaderSeparate.style.display = '';
                }
            }

            // Save assignment
            async function saveAssignment() {
                const routeId = standSelect.value;
                const isCombined = combinedRadio.checked;
                const boysBusId = isCombined ? busSelect.value : boysBusSelect.value;
                const girlsBusId = isCombined ? null : girlsBusSelect.value;
                
                if (!routeId) {
                    showStatus('দয়া করে একটি রাস্তা নির্বাচন করুন', 'error');
                    return;
                }
                
                if (isCombined && !boysBusId) {
                    showStatus('দয়া করে একটি বাস নির্বাচন করুন', 'error');
                    return;
                }
                
                if (!isCombined && !boysBusId && !girlsBusId) {
                    showStatus('দয়া করে কমপক্ষে একটি বাস নির্বাচন করুন', 'error');
                    return;
                }

                try {
                    saveBtn.disabled = true;
                    saveBtn.innerHTML = '<span class="spinner"></span> সেভ হচ্ছে...';
                    
                    await window.electronAPI.saveAssignment({
                        routeId,
                        boysBusId: boysBusId || null,
                        girlsBusId: girlsBusId || null,
                        isCombined
                    });
                    
                    showStatus('সফলভাবে সেভ করা হয়েছে!', 'success');
                    await reloadAssignments();
                    updateDisabledOptions();
                } catch (error) {
                    console.error('Error saving assignment:', error);
                    showStatus('একটি ত্রুটি হয়েছে। আবার চেষ্টা করুন।', 'error');
                } finally {
                    saveBtn.disabled = false;
                    saveBtn.textContent = 'সেভ করুন';
                }
            }

            // Run auto assignment
            async function runAutoAssignment() {
                try {
                    runAutoAssignBtn.disabled = true;
                    runAutoAssignBtn.innerHTML = '<span class="spinner"></span> প্রক্রিয়াধীন...';
                    
                    const fillRatio = filRatioSelect.value === 'custom' 
                        ? customPercentageInput.value 
                        : filRatioSelect.value;
                    
                    const result = await window.electronAPI.runAutoAssignment({
                        fillRatio,
                        busMethod: busMethodSelect.value,
                        priority: prioritySelect.value
                    });
                    
                    showStatus(`${result.length} টি রাস্তায় বাস নির্ধারণ করা হয়েছে!`, 'success');
                    await reloadAutoAssignments();
                } catch (error) {
                    console.error('Error during auto assignment:', error);
                    showStatus('স্বয়ংক্রিয় নির্ধারণে ত্রুটি হয়েছে', 'error');
                } finally {
                    runAutoAssignBtn.disabled = false;
                    runAutoAssignBtn.textContent = 'স্বয়ংক্রিয় নির্ধারণ চালান';
                }
            }

            // Filter auto assignments
            function filterAutoAssignments() {
                const tbody = document.querySelector('#auto-assignments-table tbody');
                tbody.innerHTML = '';
                
                const filtered = currentFilter === 'all' 
                    ? autoAssignments 
                    : autoAssignments.filter(a => a.shift === currentFilter);
                
                populateAutoAssignmentsTable(filtered);
            }

            // Load audio for selected route
            async function loadRouteAudio() {
                const routeId = standSelect.value;
                if (routeId) {
                    try {
                        const audio = await window.electronAPI.getAudioForRoute(routeId);
                        if (audio && audio.filePath) {
                            audioPlayer.src = audio.filePath;
                            audioPreview.style.display = 'block';
                        } else {
                            audioPlayer.src = '';
                            audioPreview.style.display = 'none';
                        }
                    } catch (error) {
                        console.error('Error loading audio:', error);
                        audioPreview.style.display = 'none';
                    }
                } else {
                    audioPreview.style.display = 'none';
                }
            }

            // Open settings window
            async function openSettingsWindow() {
                try {
                    await window.electronAPI.openSettingsWindow();
                } catch (error) {
                    console.error('Error opening settings window:', error);
                    showStatus('সেটিংস উইন্ডো খুলতে সমস্যা হয়েছে', 'error');
                }
            }

            // Show status message
            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.className = 'status-message';
                statusMessage.classList.add(`status-${type}`);
                
                setTimeout(() => {
                    statusMessage.classList.remove(`status-${type}`);
                    statusMessage.textContent = '';
                }, 5000);
            }

            // Reload assignments
            async function reloadAssignments() {
                try {
                    assignments = await window.electronAPI.getManualAssignments();
                    populateAssignmentsTable();
                } catch (error) {
                    console.error('Error loading assignments:', error);
                    showStatus('নির্ধারণ লোড করতে সমস্যা হয়েছে', 'error');
                }
            }

            // Reload auto assignments
            async function reloadAutoAssignments() {
                try {
                    autoAssignments = await window.electronAPI.getAutoAssignments();
                    filterAutoAssignments();
                } catch (error) {
                    console.error('Error loading auto assignments:', error);
                    showStatus('স্বয়ংক্রিয় নির্ধারণ লোড করতে সমস্যা হয়েছে', 'error');
                }
            }

            // Populate route selects
            function populateRouteSelects() {
                standSelect.innerHTML = '<option value="">-- রাস্তা নির্ধারণ করুন --</option>';
                
                // Combine morning and day routes with shift indicator
                const allRoutes = [
                    ...routes.morning.map(r => ({ ...r, shift: 'morning' })),
                    ...routes.day.map(r => ({ ...r, shift: 'day' }))
                ];
                
                allRoutes.forEach(route => {
                    const option = document.createElement('option');
                    option.value = route.id;
                    option.textContent = `${route.name} (${route.shift === 'morning' ? 'প্রভাতি' : 'দিবা'})`;
                    option.dataset.shift = route.shift;
                    standSelect.appendChild(option);
                });
            }

            // Populate bus selects
            function populateBusSelects() {
                // Combined bus select (all buses)
                busSelect.innerHTML = '<option value="">-- বাস নির্ধারণ করুন --</option>';
                
                // Boys bus select
                boysBusSelect.innerHTML = '<option value="">-- ছাত্রদের বাস নির্ধারণ করুন --</option>';
                
                // Girls bus select
                girlsBusSelect.innerHTML = '<option value="">-- ছাত্রী বাস নির্ধারণ করুন --</option>';
                
                buses.forEach(bus => {
                    const option = document.createElement('option');
                    option.value = bus.id;
                    option.textContent = `বাস নং ${bus.number} (${bus.capacity} জন)`;
                    
                    // Combined bus accepts all active buses
                    busSelect.appendChild(option.cloneNode(true));
                    
                    // Boys bus accepts boys and mixed buses
                    if (bus.type === 'boys' || bus.type === 'mixed') {
                        boysBusSelect.appendChild(option.cloneNode(true));
                    }
                    
                    // Girls bus accepts girls and mixed buses
                    if (bus.type === 'girls' || bus.type === 'mixed') {
                        girlsBusSelect.appendChild(option.cloneNode(true));
                    }
                });
            }

            // Update disabled options in selects
            function updateDisabledOptions() {
                // Disable already assigned routes
                const assignedRouteIds = assignments.map(a => a.route_id);
                Array.from(standSelect.options).forEach(option => {
                    if (option.value && assignedRouteIds.includes(option.value)) {
                        option.disabled = true;
                        option.style.color = '#999';
                    } else {
                        option.disabled = false;
                        option.style.color = '';
                    }
                });
                
                // Disable already assigned buses (for combined mode)
                const assignedBusIds = assignments
                    .filter(a => a.is_combined)
                    .map(a => a.boys_bus_id);
                Array.from(busSelect.options).forEach(option => {
                    if (option.value && assignedBusIds.includes(option.value)) {
                        option.disabled = true;
                        option.style.color = '#999';
                    } else {
                        option.disabled = false;
                        option.style.color = '';
                    }
                });
                
                // Disable already assigned boys buses (for separate mode)
                const assignedBoysBusIds = assignments
                    .filter(a => !a.is_combined)
                    .map(a => a.boys_bus_id)
                    .filter(id => id);
                Array.from(boysBusSelect.options).forEach(option => {
                    if (option.value && assignedBoysBusIds.includes(option.value)) {
                        option.disabled = true;
                        option.style.color = '#999';
                    } else {
                        option.disabled = false;
                        option.style.color = '';
                    }
                });
                
                // Disable already assigned girls buses (for separate mode)
                const assignedGirlsBusIds = assignments
                    .filter(a => !a.is_combined)
                    .map(a => a.girls_bus_id)
                    .filter(id => id);
                Array.from(girlsBusSelect.options).forEach(option => {
                    if (option.value && assignedGirlsBusIds.includes(option.value)) {
                        option.disabled = true;
                        option.style.color = '#999';
                    } else {
                        option.disabled = false;
                        option.style.color = '';
                    }
                });
            }

            // Populate assignments table
            function populateAssignmentsTable() {
                const tbody = document.querySelector('#assignments-table tbody');
                tbody.innerHTML = '';
                
                assignments.forEach((assignment, index) => {
                    const row = document.createElement('tr');
                    
                    if (assignment.is_combined) {
                        row.innerHTML = `
                            <td>${assignment.route_name} (${assignment.shift === 'morning' ? 'প্রভাতি' : 'দিবা'})</td>
                            <td class="boys-bus">${assignment.boys_bus || '-'}</td>
                            <td>
                                ${assignment.audio_path ? 
                                    `<audio controls class="audio-player" src="${assignment.audio_path}"></audio>` : 
                                    'কোনো অডিও নেই'}
                            </td>
                            <td><button class="action-btn" data-id="${assignment.id}">🗑️</button></td>
                        `;
                    } else {
                        row.innerHTML = `
                            <td>${assignment.route_name} (${assignment.shift === 'morning' ? 'প্রভাতি' : 'দিবা'})</td>
                            <td class="boys-bus">${assignment.boys_bus || '-'}</td>
                            <td class="girls-bus">${assignment.girls_bus || '-'}</td>
                            <td>
                                ${assignment.audio_path ? 
                                    `<audio controls class="audio-player" src="${assignment.audio_path}"></audio>` : 
                                    'কোনো অডিও নেই'}
                            </td>
                            <td><button class="action-btn" data-id="${assignment.id}">🗑️</button></td>
                        `;
                    }
                    
                    tbody.appendChild(row);
                    
                    // Add delete event listener
                    row.querySelector('.action-btn').addEventListener('click', async () => {
                        if (confirm('আপনি কি এই নির্ধারণ মুছে ফেলতে চান?')) {
                            try {
                                await window.electronAPI.deleteAssignment(assignment.id);
                                showStatus('নির্ধারণ সফলভাবে মুছে ফেলা হয়েছে', 'success');
                                await reloadAssignments();
                                updateDisabledOptions();
                            } catch (error) {
                                console.error('Error deleting assignment:', error);
                                showStatus('নির্ধারণ মুছতে সমস্যা হয়েছে', 'error');
                            }
                        }
                    });
                });
            }

            // Populate auto assignments table
            function populateAutoAssignmentsTable(data = autoAssignments) {
                const tbody = document.querySelector('#auto-assignments-table tbody');
                tbody.innerHTML = '';
                
                data.forEach((assignment, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${assignment.route_name}</td>
                        <td class="boys-bus">${assignment.boys_bus || '-'}</td>
                        <td class="girls-bus">${assignment.girls_bus || '-'}</td>
                        <td>${assignment.shift === 'morning' ? 'প্রভাতি' : 'দিবা'}</td>
                        <td><button class="action-btn" data-id="${assignment.id}">🗑️</button></td>
                    `;
                    tbody.appendChild(row);
                    
                    // Add delete event listener
                    row.querySelector('.action-btn').addEventListener('click', async () => {
                        if (confirm('আপনি কি এই নির্ধারণ মুছে ফেলতে চান?')) {
                            try {
                                await window.electronAPI.deleteAssignment(assignment.id);
                                showStatus('নির্ধারণ সফলভাবে মুছে ফেলা হয়েছে', 'success');
                                await reloadAutoAssignments();
                            } catch (error) {
                                console.error('Error deleting assignment:', error);
                                showStatus('নির্ধারণ মুছতে সমস্যা হয়েছে', 'error');
                            }
                        }
                    });
                });
            }

            // Prepare auto mode print
            async function prepareAutoPrint() {
                printModal.style.display = 'none';
                
                try {
                    const dataToPrint = currentFilter === 'all' 
                        ? autoAssignments 
                        : autoAssignments.filter(a => a.shift === currentFilter);
                    
                    printSubtitle.textContent = `${currentFilter === 'morning' ? 'প্রভাতি' : currentFilter === 'day' ? 'দিবা' : 'সব'} শাখা - ${new Date().toLocaleDateString('bn-BD')}`;
                    
                    // Set table header for auto mode
                    printTableHeader.innerHTML = `
                        <th>ক্রমিক</th>
                        <th>স্ট্যান্ডসমূহ</th>
                        <th>ছাত্র (বাস নং)</th>
                        <th>ছাত্রী (বাস নং)</th>
                        <th>শাখা</th>
                    `;
                    
                    // Populate table body
                    printTableBody.innerHTML = '';
                    dataToPrint.forEach((assignment, index) => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${index + 1}</td>
                            <td>${assignment.route_name}</td>
                            <td class="boys-bus">${assignment.boys_bus || '-'}</td>
                            <td class="girls-bus">${assignment.girls_bus || '-'}</td>
                            <td>${assignment.shift === 'morning' ? 'প্রভাতি' : 'দিবা'}</td>
                        `;
                        printTableBody.appendChild(row);
                    });
                    
                    printPreviewModal.style.display = 'flex';
                } catch (error) {
                    console.error('Error preparing print data:', error);
                    showStatus('প্রিন্ট ডেটা প্রস্তুত করতে সমস্যা হয়েছে', 'error');
                }
            }

            // Prepare manual mode print
            async function prepareManualPrint() {
                printModal.style.display = 'none';
                
                try {
                    printSubtitle.textContent = `ম্যানুয়াল নির্ধারণ - ${new Date().toLocaleDateString('bn-BD')}`;
                    
                    // Set table header based on assignments type
                    const hasSeparateAssignments = assignments.some(a => !a.is_combined);
                    
                    if (hasSeparateAssignments) {
                        printTableHeader.innerHTML = `
                            <th>ক্রমিক</th>
                            <th>স্ট্যান্ডসমূহ</th>
                            <th>ছাত্র (বাস নং)</th>
                            <th>ছাত্রী (বাস নং)</th>
                            <th>শাখা</th>
                        `;
                    } else {
                        printTableHeader.innerHTML = `
                            <th>ক্রমিক</th>
                            <th>স্ট্যান্ডসমূহ</th>
                            <th>বাস নং</th>
                            <th>শাখা</th>
                        `;
                    }
                    
                    // Populate table body
                    printTableBody.innerHTML = '';
                    assignments.forEach((assignment, index) => {
                        const row = document.createElement('tr');
                        
                        if (assignment.is_combined) {
                            row.innerHTML = `
                                <td>${index + 1}</td>
                                <td>${assignment.route_name}</td>
                                <td class="boys-bus">${assignment.boys_bus || '-'}</td>
                                <td>${assignment.shift === 'morning' ? 'প্রভাতি' : 'দিবা'}</td>
                            `;
                        } else {
                            row.innerHTML = `
                                <td>${index + 1}</td>
                                <td>${assignment.route_name}</td>
                                <td class="boys-bus">${assignment.boys_bus || '-'}</td>
                                <td class="girls-bus">${assignment.girls_bus || '-'}</td>
                                <td>${assignment.shift === 'morning' ? 'প্রভাতি' : 'দিবা'}</td>
                            `;
                        }
                        
                        printTableBody.appendChild(row);
                    });
                    
                    printPreviewModal.style.display = 'flex';
                } catch (error) {
                    console.error('Error preparing print data:', error);
                    showStatus('প্রিন্ট ডেটা প্রস্তুত করতে সমস্যা হয়েছে', 'error');
                }
            }

            // Confirm print
            function confirmPrint() {
                window.electronAPI.printContent(printPreviewContent.innerHTML);
                printPreviewModal.style.display = 'none';
                showStatus('প্রিন্ট করা হয়েছে', 'success');
            }

            // Show auto display
            async function showAutoDisplay() {
                displayModal.style.display = 'none';
                
                try {
                    const dataToDisplay = currentFilter === 'all' 
                        ? autoAssignments 
                        : autoAssignments.filter(a => a.shift === currentFilter);
                    
                    displayTitle.textContent = `স্বয়ংক্রিয় নির্ধারণ (${currentFilter === 'morning' ? 'প্রভাতি' : currentFilter === 'day' ? 'দিবা' : 'সব'} শাখা)`;
                    
                    // Populate display routes
                    displayRoutesContainer.innerHTML = '';
                    dataToDisplay.forEach(assignment => {
                        const routeDiv = document.createElement('div');
                        routeDiv.className = 'mb-6';
                        
                        const routeName = document.createElement('div');
                        routeName.className = 'display-route';
                        routeName.textContent = assignment.route_name;
                        
                        const busesDiv = document.createElement('div');
                        
                        if (assignment.boys_bus) {
                            const boysBus = document.createElement('span');
                            boysBus.className = 'display-bus display-bus-boys';
                            boysBus.textContent = `ছাত্র: ${assignment.boys_bus}`;
                            busesDiv.appendChild(boysBus);
                        }
                        
                        if (assignment.girls_bus) {
                            const girlsBus = document.createElement('span');
                            girlsBus.className = 'display-bus display-bus-girls';
                            girlsBus.textContent = `ছাত্রী: ${assignment.girls_bus}`;
                            busesDiv.appendChild(girlsBus);
                        }
                        
                        routeDiv.appendChild(routeName);
                        routeDiv.appendChild(busesDiv);
                        displayRoutesContainer.appendChild(routeDiv);
                    });
                    
                    displayScreenModal.style.display = 'flex';
                } catch (error) {
                    console.error('Error preparing display data:', error);
                    showStatus('ডিসপ্লে ডেটা প্রস্তুত করতে সমস্যা হয়েছে', 'error');
                }
            }

            // Show manual display
            async function showManualDisplay() {
                displayModal.style.display = 'none';
                
                try {
                    displayTitle.textContent = 'ম্যানুয়াল নির্ধারণ';
                    
                    // Populate display routes
                    displayRoutesContainer.innerHTML = '';
                    assignments.forEach(assignment => {
                        const routeDiv = document.createElement('div');
                        routeDiv.className = 'mb-6';
                        
                        const routeName = document.createElement('div');
                        routeName.className = 'display-route';
                        routeName.textContent = `${assignment.route_name} (${assignment.shift === 'morning' ? 'প্রভাতি' : 'দিবা'})`;
                        
                        const busesDiv = document.createElement('div');
                        
                        if (assignment.is_combined) {
                            const bus = document.createElement('span');
                            bus.className = 'display-bus display-bus-boys';
                            bus.textContent = `বাস: ${assignment.boys_bus || '-'}`;
                            busesDiv.appendChild(bus);
                        } else {
                            if (assignment.boys_bus) {
                                const boysBus = document.createElement('span');
                                boysBus.className = 'display-bus display-bus-boys';
                                boysBus.textContent = `ছাত্র: ${assignment.boys_bus}`;
                                busesDiv.appendChild(boysBus);
                            }
                            
                            if (assignment.girls_bus) {
                                const girlsBus = document.createElement('span');
                                girlsBus.className = 'display-bus display-bus-girls';
                                girlsBus.textContent = `ছাত্রী: ${assignment.girls_bus}`;
                                busesDiv.appendChild(girlsBus);
                            }
                        }
                        
                        routeDiv.appendChild(routeName);
                        routeDiv.appendChild(busesDiv);
                        displayRoutesContainer.appendChild(routeDiv);
                    });
                    
                    displayScreenModal.style.display = 'flex';
                } catch (error) {
                    console.error('Error preparing display data:', error);
                    showStatus('ডিসপ্লে ডেটা প্রস্তুত করতে সমস্যা হয়েছে', 'error');
                }
            }

            // Generate audio
            async function generateAudio() {
                try {
                    generateAudioBtn.disabled = true;
                    generateAudioBtn.innerHTML = '<span class="spinner"></span> তৈরি হচ্ছে...';
                    
                    const shift = audioShiftSelect.value;
                    const audioFile = await window.electronAPI.generateAudioAnnouncement(shift);
                    
                    if (audioFile) {
                        audioGeneratorPlayer.src = audioFile;
                        audioPreviewContainer.style.display = 'block';
                        showStatus('অডিও সফলভাবে তৈরি করা হয়েছে', 'success');
                    } else {
                        showStatus('অডিও তৈরি করতে সমস্যা হয়েছে', 'error');
                    }
                } catch (error) {
                    console.error('Error generating audio:', error);
                    showStatus('অডিও তৈরি করতে সমস্যা হয়েছে', 'error');
                } finally {
                    generateAudioBtn.disabled = false;
                    generateAudioBtn.textContent = 'অডিও জেনারেট করুন';
                }
            }

            // Listen for refresh-data event
            window.electronAPI.on('refresh-data', async () => {
                await loadInitialData();
                showStatus('ডেটা রিফ্রেশ করা হয়েছে', 'success');
            });
        });
    </script>
</body>
</html>